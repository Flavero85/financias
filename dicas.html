<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dicas e Simuladores Financeiros</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #1c1e21;
            --primary-color: #1877f2;
            --green: #42b72a;
            --red: #fa3e3e;
            --orange: #f0ad4e;
            --bitcoin-orange: #f7931a;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 800px;
        }
        h1, h3 {
            text-align: center;
            color: var(--primary-color);
        }
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            border-left: 5px solid var(--primary-color);
        }
        .card.alert { border-left-color: var(--red); }
        .card.warning { border-left-color: var(--orange); }
        .card.good { border-left-color: var(--green); }
        .card.crypto { border-left-color: var(--bitcoin-orange); }
        .card.investment { border-left-color: var(--primary-color); }

        .card h3 {
            margin-top: 0;
            color: #333;
            display: flex;
            align-items: center;
            font-size: 1.25rem;
        }
        .card h3 span {
            font-size: 1.5rem;
            margin-right: 12px;
        }
        #no-data {
            text-align: center;
            font-size: 1.2rem;
            color: #777;
        }
        a.button, .simulador-btn {
            display: block;
            width: auto;
            max-width: 300px;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 6px;
            font-size: 1.1rem;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            font-weight: bold;
            margin: 0 auto 20px auto;
            border: none;
        }
        a.button:hover, .simulador-btn:hover {
            opacity: 0.9;
        }
        .price-up { color: var(--green); }
        .price-down { color: var(--red); }
        .crypto-grid { display: grid; grid-template-columns: 1fr 1fr; text-align: center; gap: 10px; }

        .simulador-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .simulador-grid input, .simulador-grid select {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-size: 1rem;
            box-sizing: border-box;
        }
        .simulador-resultado {
            margin-top: 15px;
            padding: 15px;
            background-color: #f0f8ff;
            border-left: 3px solid var(--primary-color);
            border-radius: 4px;
        }
        .disclaimer {
            font-size: 0.8rem;
            color: #777;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="button">&larr; Voltar para a Calculadora</a>
        <h1>Dicas e Simuladores</h1>
        
        <div id="crypto-widget" class="card crypto"><p>Buscando dados de cota√ß√£o...</p></div>

        <div id="tips-container">
            <p id="no-data">Nenhum dado encontrado para gerar dicas. Preencha os valores na p√°gina inicial primeiro.</p>
        </div>

        <div class="card investment">
            <h3><span>üè¶</span> Simulador de Cofre (110% do CDI)</h3>
            <div class="simulador-grid">
                <div><label for="cdi-inicial">Valor Inicial (R$)</label><input type="number" id="cdi-inicial" placeholder="1000"></div>
                <div><label for="cdi-aporte">Aporte Mensal (R$)</label><input type="number" id="cdi-aporte" placeholder="200"></div>
                <div><label for="cdi-meses">Per√≠odo (meses)</label><input type="number" id="cdi-meses" placeholder="12"></div>
            </div>
            <button id="cdi-simular-btn" class="simulador-btn">Simular</button>
            <div id="cdi-resultado" class="simulador-resultado" style="display:none;"></div>
            <p class="disclaimer">Simula√ß√£o com taxa de exemplo de 10,50% ao ano para o CDI (11,55% para 110% do CDI). N√£o considera impostos. Apenas para fins educativos.</p>
        </div>

        <div class="card crypto">
            <h3><span>üìà</span> Simulador Hist√≥rico de Bitcoin</h3>
            <div class="simulador-grid">
                <div><label for="btc-valor">Se eu tivesse investido (R$)</label><input type="number" id="btc-valor" placeholder="1000"></div>
                <div><label for="btc-data">Quando?</label><select id="btc-data">
                    <option value="1">1 ano atr√°s</option>
                    <option value="3">3 anos atr√°s</option>
                    <option value="5">5 anos atr√°s</option>
                </select></div>
            </div>
            <button id="btc-simular-btn" class="simulador-btn">Simular "E se?"</button>
            <div id="btc-resultado" class="simulador-resultado" style="display:none;"></div>
            <p class="disclaimer"><b>Importante:</b> Esta √© uma simula√ß√£o com dados do passado. Retornos passados n√£o garantem retornos futuros. Criptomoedas s√£o ativos de alt√≠ssimo risco.</p>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Seletores
            const tipsContainer = document.getElementById('tips-container');
            const cryptoWidget = document.getElementById('crypto-widget');
            const noDataEl = document.getElementById('no-data');
            const data = JSON.parse(localStorage.getItem('financeData_current'));
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            const formatCurrency = (value) => (value || 0).toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});

            // --- L√≥gica das Dicas ---
            function createTipCard(icon, title, message, type = '') {
                const card = document.createElement('div');
                card.className = `card ${type}`;
                card.innerHTML = `<h3><span>${icon}</span>${title}</h3><div>${message}</div>`;
                tipsContainer.appendChild(card);
            }
            
            function generateAllTips() {
                if (data && (data.totalGastos > 0 || data.totalRendas > 0)) {
                    noDataEl.style.display = 'none';

                    if (data.saldoFinal < 0) {
                        createTipCard('üö®', 'Alerta M√°ximo: Saldo Negativo!', `Seu saldo est√° negativo em <strong>${formatCurrency(data.saldoFinal)}</strong>. Esta √© a prioridade n√∫mero 1. √â crucial reduzir despesas imediatamente.`, 'alert');
                    }

                    const findCategoryById = (id) => categories.find(c => c.id === id);
                    const getCategoryLabel = (id, defaultLabel) => {
                        const cat = findCategoryById(id);
                        return cat ? cat.label : defaultLabel;
                    };

                    const cartoesLabel = getCategoryLabel('cartoes', 'Cart√µes');
                    if (data.cartoes && data.totalRendas > 0 && (data.cartoes / data.totalRendas) > 0.3) {
                        createTipCard('üí≥', `Foco nos ${cartoesLabel}`, `Seus gastos com ${cartoesLabel} (<strong>${formatCurrency(data.cartoes)}</strong>) consomem <strong>${((data.cartoes / data.totalRendas) * 100).toFixed(0)}%</strong> da sua renda. Este √© um n√≠vel perigoso. Evite novas compras parceladas.`, 'warning');
                    }
                    
                    if (data.saldoFinal > 0) {
                        const investmentMessage = `<p>Seu saldo est√° positivo, parab√©ns! Este √© o momento ideal para planejar o futuro do seu dinheiro. Use os simuladores abaixo para come√ßar a visualizar o potencial dos seus investimentos. Siga estes passos:</p><ol><li><strong>Construa sua Reserva de Emerg√™ncia:</strong> Junte de 3 a 6 meses do seu custo de vida em um investimento seguro e de f√°cil acesso (como um que renda 100% do CDI ou mais).</li><li><strong>Defina Seus Objetivos:</strong> O que voc√™ quer alcan√ßar com o dinheiro? Metas claras ajudam a escolher os melhores investimentos.</li><li><strong>Comece a Estudar e Investir:</strong> Entenda seu perfil de risco e comece a investir todo m√™s, mesmo que seja pouco.</li></ol>`;
                        createTipCard('üöÄ', 'Parab√©ns e Pr√≥ximos Passos!', investmentMessage, 'good');
                    }
                } else {
                    noDataEl.style.display = 'block';
                    cryptoWidget.style.display = 'none';
                }
            }
            
            // --- L√≥gica do Widget de Cota√ß√£o ---
            async function fetchCryptoData() {
                try {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const dateString = `${yesterday.getDate()}-${yesterday.getMonth() + 1}-${yesterday.getFullYear()}`;
                    
                    const [currentPriceResponse, historyPriceResponse] = await Promise.all([
                        fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=brl'),
                        fetch(`https://api.coingecko.com/api/v3/coins/bitcoin/history?date=${dateString}`)
                    ]);

                    let widgetHTML = `<h3><span>‚Çø</span>Cota√ß√£o do Bitcoin (BTC)</h3>`;
                    
                    if (!currentPriceResponse.ok) throw new Error('Falha ao buscar o pre√ßo atual.');
                    const currentPriceData = await currentPriceResponse.json();
                    const currentPrice = currentPriceData?.bitcoin?.brl;

                    if (!currentPrice) throw new Error('Pre√ßo atual n√£o encontrado na resposta da API.');
                    
                    const historyPriceData = historyPriceResponse.ok ? await historyPriceResponse.json() : null;
                    const yesterdayPrice = historyPriceData?.market_data?.current_price?.brl;
                    
                    if (yesterdayPrice) {
                        const variation = ((currentPrice - yesterdayPrice) / yesterdayPrice) * 100;
                        const variationClass = variation >= 0 ? 'price-up' : 'price-down';
                        const variationSign = variation >= 0 ? '‚ñ≤' : '‚ñº';
                        widgetHTML += `<div class="crypto-grid"><div><p style="margin: 5px 0; font-size: 0.9rem;">Pre√ßo Atual</p><p style="font-size: 1.5rem; margin: 5px 0;"><strong>${formatCurrency(currentPrice)}</strong></p></div><div><p style="margin: 5px 0; font-size: 0.9rem;">Pre√ßo de Ontem</p><p style="font-size: 1.2rem; margin: 5px 0;">${formatCurrency(yesterdayPrice)}</p></div></div><p style="text-align: center; font-size: 1.2rem; margin-top: 15px;">Varia√ß√£o (24h): <strong class="${variationClass}">${variationSign} ${variation.toFixed(2)}%</strong></p>`;
                    } else {
                        widgetHTML += `<p>Pre√ßo atual: <strong>${formatCurrency(currentPrice)}</strong> (N√£o foi poss√≠vel obter o pre√ßo de ontem).</p>`;
                    }
                    
                    widgetHTML += `<p class="disclaimer" style="text-align:center;">Fonte: CoinGecko. N√£o √© uma recomenda√ß√£o de investimento.</p>`;
                    cryptoWidget.innerHTML = widgetHTML;

                } catch (error) {
                    cryptoWidget.innerHTML = `<h3><span>‚Çø</span>Cota√ß√£o do Bitcoin (BTC)</h3><p>N√£o foi poss√≠vel buscar a cota√ß√£o no momento.</p>`;
                    console.error("Erro ao buscar dados do Bitcoin:", error);
                }
            }

            // --- L√≥gica do Simulador CDI ---
            document.getElementById('cdi-simular-btn').addEventListener('click', () => {
                const valorInicial = parseFloat(document.getElementById('cdi-inicial').value) || 0;
                const aporteMensal = parseFloat(document.getElementById('cdi-aporte').value) || 0;
                const meses = parseInt(document.getElementById('cdi-meses').value) || 0;
                const resultadoEl = document.getElementById('cdi-resultado');

                if (meses === 0) return;

                const taxaCDIAnual = 0.105; // Exemplo: 10,50%
                const taxaAnual = taxaCDIAnual * 1.10; // 110% do CDI
                const taxaMensal = Math.pow(1 + taxaAnual, 1/12) - 1;

                let total = valorInicial;
                for (let i = 0; i < meses; i++) {
                    total = total * (1 + taxaMensal);
                    total += aporteMensal;
                }
                
                const totalInvestido = valorInicial + (aporteMensal * meses);
                const juros = total - totalInvestido;

                resultadoEl.innerHTML = `
                    <p>Total investido: <strong>${formatCurrency(totalInvestido)}</strong></p>
                    <p>Juros ganhos: <strong>${formatCurrency(juros)}</strong></p>
                    <p>Valor final acumulado: <strong style="font-size:1.2rem;">${formatCurrency(total)}</strong></p>
                `;
                resultadoEl.style.display = 'block';
            });
            
            // --- L√≥gica do Simulador Bitcoin ---
            document.getElementById('btc-simular-btn').addEventListener('click', async () => {
                const valorInvestido = parseFloat(document.getElementById('btc-valor').value) || 0;
                const anosAtras = parseInt(document.getElementById('btc-data').value) || 0;
                const resultadoEl = document.getElementById('btc-resultado');
                
                if (valorInvestido === 0 || anosAtras === 0) return;
                
                resultadoEl.innerHTML = `<p>Buscando dados hist√≥ricos...</p>`;
                resultadoEl.style.display = 'block';

                try {
                    const startDate = new Date();
                    startDate.setFullYear(startDate.getFullYear() - anosAtras);
                    const dateString = `${startDate.getDate()}-${startDate.getMonth() + 1}-${startDate.getFullYear()}`;
                    
                    const [currentPriceResponse, historyPriceResponse] = await Promise.all([
                        fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=brl'),
                        fetch(`https://api.coingecko.com/api/v3/coins/bitcoin/history?date=${dateString}`)
                    ]);

                    const currentPriceData = await currentPriceResponse.json();
                    const historyPriceData = await historyPriceResponse.json();

                    const currentPrice = currentPriceData?.bitcoin?.brl;
                    const startPrice = historyPriceData?.market_data?.current_price?.brl;
                    
                    if (!currentPrice || !startPrice) throw new Error('Dados hist√≥ricos n√£o dispon√≠veis para esta data.');
                    
                    const btcComprados = valorInvestido / startPrice;
                    const valorFinal = btcComprados * currentPrice;
                    const rendimento = valorFinal - valorInvestido;
                    const percentual = (rendimento / valorInvestido) * 100;

                    resultadoEl.innerHTML = `
                        <p>Valor do BTC na data: <strong>${formatCurrency(startPrice)}</strong></p>
                        <p>Com ${formatCurrency(valorInvestido)}, voc√™ teria comprado <strong>${btcComprados.toFixed(6)} BTC</strong>.</p>
                        <p>Hoje, esse valor seria: <strong class="${rendimento >= 0 ? 'price-up' : 'price-down'}" style="font-size:1.2rem;">${formatCurrency(valorFinal)}</strong></p>
                        <p>Rendimento: <strong>${formatCurrency(rendimento)} (${percentual.toFixed(0)}%)</strong></p>
                    `;

                } catch(e) {
                    resultadoEl.innerHTML = `<p class="price-down">N√£o foi poss√≠vel obter os dados hist√≥ricos para a simula√ß√£o. Tente novamente mais tarde.</p>`;
                    console.error("Erro na simula√ß√£o BTC:", e);
                }
            });

            // Inicializa√ß√£o
            generateAllTips();
            fetchCryptoData();
        });
    </script>
</body>
</html>